# 快速开始指南 🚀

本指南将帮助你在5-10分钟内完成Outlook邮箱配置。

## 📝 准备工作

在开始之前,请准备:

- ✅ 一个Outlook/Hotmail邮箱账号
- ✅ Azure Portal访问权限 (个人Microsoft账号即可)
- ✅ 能够启用双重验证的手机

---

## ⚡ 快速配置步骤

### 第1步: Azure应用注册 (5分钟)

1. 访问 [Azure Portal](https://portal.azure.com/) 并登录
2. 搜索 **"应用注册"** → 点击 **"新注册"**
3. 填写:
   - **名称**: `DailySummaryApp`
   - **账户类型**: 仅此组织目录
4. 注册后,复制以下信息:
   ```
   应用程序(客户端) ID → 记为 OUTLOOK_CLIENT_ID
   目录(租户) ID       → 记为 OUTLOOK_TENANT_ID
   ```
5. 点击 **"证书和密码"** → **"新客户端密码"**
   ```
   复制密钥值 → 记为 OUTLOOK_CLIENT_SECRET
   ```
6. 点击 **"API权限"** → **"添加权限"**
   - 选择 **Microsoft Graph** → **应用程序权限**
   - 添加 `Mail.Read`
   - 点击 **"授予管理员同意"** ✅

### 第2步: SMTP应用密码 (3分钟)

1. 访问 [Microsoft账户安全](https://account.microsoft.com/security)
2. 启用 **"双重验证"** (如果未启用)
3. 找到 **"应用密码"** → **"创建新密码"**
4. 复制生成的密码:
   ```
   16位密码 → 记为 OUTLOOK_SMTP_PASSWORD
   ```

### 第3步: 配置环境变量 (2分钟)

1. 复制示例文件:
   ```bash
   cp env.example .env
   ```

2. 编辑 `.env` 文件,填入你的信息:
   ```bash
   # Outlook配置
   OUTLOOK_EMAIL=你的邮箱@outlook.com
   OUTLOOK_CLIENT_ID=刚才复制的Client_ID
   OUTLOOK_CLIENT_SECRET=刚才复制的Secret
   OUTLOOK_TENANT_ID=刚才复制的Tenant_ID
   OUTLOOK_SMTP_PASSWORD=刚才复制的SMTP密码
   
   # 邮件筛选
   EMAIL_FILTER_SENDER=发送每日总结的邮箱
   
   # Gemini AI (可选)
   GEMINI_API_KEY=你的Gemini_API_Key
   
   # 接收结果的邮箱
   SUMMARY_RECIPIENT=接收分析结果的邮箱
   ```

### 第4步: 安装依赖

```bash
# 安装workflow-tools
cd workflow-tools
pip install -e .[all]
cd ..

# 安装主程序依赖
pip install -r requirements.txt
```

### 第5步: 测试配置

```bash
# 测试邮件读取
python test_outlook_read.py

# 测试邮件发送
python test_outlook_send.py
```

如果两个测试都显示 ✓ ,说明配置成功!

---

## 🎯 运行程序

### 方式1: 立即执行一次

修改 `main.py`:

```python
if __name__ == "__main__":
    workflow = DailySummaryWorkflow()
    workflow.initialize_clients()
    workflow.process_daily_summary()  # 直接执行
```

然后运行:

```bash
python main.py
```

### 方式2: 启动定时任务

直接运行:

```bash
python main.py
```

程序会在后台运行,每晚10点自动执行。

---

## 🔍 验证配置

使用项目提供的验证工具:

```bash
cd workflow-tools
python validate_config.py
```

这个工具会自动检查:
- ✅ 环境变量完整性
- ✅ Microsoft Graph API连接
- ✅ 邮件读取权限
- ✅ SMTP发送功能

---

## ❓ 遇到问题?

### 问题1: Azure认证失败

```
✗ 连接失败: 认证失败
```

**解决方案**:
- 检查Client ID、Secret、Tenant ID是否正确
- 确认API权限已授予管理员同意
- 检查客户端密钥是否已过期

### 问题2: SMTP认证失败

```
✗ SMTP认证失败
```

**解决方案**:
- 确认双重验证已启用
- 重新生成应用密码
- 确保密码中没有多余的空格

### 问题3: 找不到邮件

```
✓ 成功获取 0 封邮件
```

**解决方案**:
- 确认邮箱中有邮件
- 检查过滤条件是否太严格
- 调整时间范围

---

## 📚 详细文档

如需更详细的配置说明,请查看:

- **[OUTLOOK_配置指南.md](./OUTLOOK_配置指南.md)** - 完整配置教程
- **[README.md](./README.md)** - 项目文档

---

## 🎉 配置完成!

现在你可以:

1. ✅ 自动读取Outlook邮件
2. ✅ 使用Gemini AI分析内容
3. ✅ 自动发送分析结果
4. ✅ 定时执行任务

享受自动化的乐趣! 🎊

