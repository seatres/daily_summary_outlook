# QQ邮箱配置指南

本指南将帮助您配置 QQ 邮箱以用于每日总结自动化工作流。

## 📋 前提条件

- 拥有一个 QQ 邮箱账号（@qq.com）
- 手机号码（用于接收验证短信）

## 🔧 配置步骤

### 第一步：开启 IMAP/SMTP 服务

1. **登录 QQ 邮箱**
   - 访问：https://mail.qq.com
   - 使用您的 QQ 号和密码登录

2. **进入设置页面**
   - 点击页面右上角的"设置"按钮
   - 选择"账户"标签页

3. **开启 IMAP/SMTP 服务**
   - 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"部分
   - 找到"IMAP/SMTP服务"选项
   - 点击"开启"按钮

4. **生成授权码**
   - 系统会要求您发送短信验证
   - 按照页面提示使用手机发送指定短信
   - 发送成功后，页面会显示一个**授权码**（16位字符）
   - **重要**：请立即复制并保存这个授权码，它只会显示一次！

### 第二步：配置环境变量

1. **复制环境变量模板**
   ```bash
   cp env.example .env
   ```

2. **编辑 .env 文件**
   ```bash
   # 设置邮件客户端类型为 QQ 邮箱
   EMAIL_CLIENT_TYPE=qq
   
   # 设置您的 QQ 邮箱地址
   EMAIL_ADDRESS=你的QQ号@qq.com
   
   # 设置授权码（不是 QQ 密码！）
   EMAIL_PASSWORD=你的16位授权码
   
   # 设置邮件筛选发件人（发送每日总结的邮箱）
   EMAIL_FILTER_SENDER=发件人邮箱地址
   
   # 设置总结结果接收邮箱
   SUMMARY_RECIPIENT=接收总结的邮箱地址
   
   # 设置 Gemini API Key
   GEMINI_API_KEY=你的Gemini_API_Key
   ```

### 第三步：测试配置

运行测试脚本验证配置是否正确：

```bash
python check_mailbox.py
```

如果配置正确，您应该能看到：
- ✓ 成功连接到 QQ 邮箱 IMAP 服务器
- ✓ 能够读取邮件列表
- ✓ 能够发送测试邮件（如果需要）

## 📝 配置说明

### QQ 邮箱服务器信息

系统已预配置以下信息（无需手动设置）：

| 服务类型 | 服务器地址 | 端口 | 加密方式 |
|---------|-----------|------|---------|
| IMAP（收信） | imap.qq.com | 993 | SSL |
| SMTP（发信） | smtp.qq.com | 587 | STARTTLS |
| SMTP（发信） | smtp.qq.com | 465 | SSL |

**注意**：默认使用 587 端口（STARTTLS）。如需使用 465 端口（SSL），请在代码中设置 `use_ssl_for_smtp=True`。

### 授权码 vs 密码

⚠️ **重要区别**：

- **QQ 密码**：用于登录 QQ 和 QQ 邮箱网页版
- **授权码**：用于第三方客户端（如本程序）访问 QQ 邮箱

**必须使用授权码**，不能使用 QQ 密码！

## 🔒 安全建议

1. **不要分享授权码**
   - 授权码相当于密码，不要告诉任何人
   - 不要将授权码提交到 Git 仓库

2. **定期更换授权码**
   - 可以在 QQ 邮箱设置中删除旧授权码
   - 重新生成新的授权码

3. **使用环境变量**
   - 将 `.env` 文件添加到 `.gitignore`
   - 永远不要在代码中硬编码密码或授权码

## 🚨 常见问题

### 1. 登录失败：535 Authentication failed

**原因**：
- 未开启 IMAP/SMTP 服务
- 使用了 QQ 密码而不是授权码
- 授权码输入错误

**解决方案**：
- 确认已在 QQ 邮箱设置中开启 IMAP/SMTP 服务
- 确认使用的是授权码，不是 QQ 密码
- 重新生成授权码并复制粘贴（避免手动输入错误）

### 2. 连接超时

**原因**：
- 网络问题
- 防火墙阻止了端口

**解决方案**：
- 检查网络连接
- 确认防火墙允许 993（IMAP）和 587（SMTP）端口
- 尝试使用其他网络环境

### 3. 找不到邮件

**原因**：
- 邮件筛选条件太严格
- 时间范围不对
- 邮件在其他文件夹中

**解决方案**：
- 检查 `EMAIL_FILTER_SUBJECT` 和 `EMAIL_FILTER_SENDER` 配置
- 调整 `EMAIL_SEARCH_HOURS` 时间范围
- 确认邮件在"收件箱"而不是其他文件夹

### 4. 发送邮件失败

**原因**：
- SMTP 配置错误
- 授权码无效
- 发送频率过高被限制

**解决方案**：
- 确认授权码正确
- 降低发送频率
- 等待一段时间后重试

## 📚 其他邮箱支持

如果您想使用其他邮箱（如 163、Gmail 等），请：

1. 设置 `EMAIL_CLIENT_TYPE=generic`
2. 手动配置 IMAP/SMTP 服务器地址
3. 参考各邮箱的帮助文档获取服务器信息

常见邮箱服务器：

| 邮箱 | IMAP服务器 | SMTP服务器 | 端口 |
|-----|-----------|-----------|------|
| 163邮箱 | imap.163.com | smtp.163.com | 993/465 |
| 126邮箱 | imap.126.com | smtp.126.com | 993/465 |
| Gmail | imap.gmail.com | smtp.gmail.com | 993/465 |
| Outlook | outlook.office365.com | smtp-mail.outlook.com | 993/587 |

## 📞 技术支持

如遇到问题：

1. 查看日志文件：`logs/workflow_YYYYMMDD.log`
2. 使用调试模式：设置 `LOG_LEVEL=DEBUG`
3. 查阅 QQ 邮箱官方帮助：https://service.mail.qq.com/

---

**提示**：配置完成后，建议先手动运行一次程序测试，确认无误后再启用定时任务。

