# æ¯æ—¥æ€»ç»“é‚®ä»¶è‡ªåŠ¨åŒ– - ä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¯ä»¥ï¼š
1. ğŸ“§ ä»é‚®ç®±è¯»å–"æ¯æ—¥æ€»ç»“"é‚®ä»¶
2. ğŸ¤– ä½¿ç”¨ Gemini AI è¿›è¡Œæ·±åº¦åˆ†æ
3. âœ‰ï¸ å°†åˆ†æç»“æœå‘é€åˆ°æŒ‡å®šé‚®ç®±

## ğŸ“‹ ä¸¤ç§è¿è¡Œæ–¹å¼

### æ–¹å¼ 1: ç«‹å³æ‰§è¡Œï¼ˆæ¨èï¼‰

**ç‰¹ç‚¹**ï¼š
- âœ… æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨é€€å‡º
- âœ… è¯»å–è¿‡å»24å°æ—¶çš„é‚®ä»¶
- âœ… é€‚åˆé…åˆ launchd å®šæ—¶æ‰§è¡Œ
- âœ… ä¸å ç”¨ç³»ç»Ÿèµ„æº

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
python main.py --once
```

### æ–¹å¼ 2: æŒç»­è¿è¡Œ

**ç‰¹ç‚¹**ï¼š
- âœ… ç¨‹åºæŒç»­è¿è¡Œ
- âœ… æ¯æ™š22:00è‡ªåŠ¨æ‰§è¡Œ
- âš ï¸ éœ€è¦ä¿æŒç»ˆç«¯æˆ–ä½¿ç”¨åå°è¿è¡Œ

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
python main.py
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```bash
# é‚®ä»¶å®¢æˆ·ç«¯ç±»å‹
EMAIL_CLIENT_TYPE=qq

# QQé‚®ç®±é…ç½®
EMAIL_ADDRESS=ä½ çš„QQé‚®ç®±@qq.com
EMAIL_PASSWORD=QQé‚®ç®±æˆæƒç 

# é‚®ä»¶ç­›é€‰
EMAIL_FILTER_SENDER=å‘ä»¶äººé‚®ç®±

# Gemini AI
GEMINI_API_KEY=ä½ çš„Geminiå¯†é’¥

# æ€»ç»“æ¥æ”¶é‚®ç®±
SUMMARY_RECIPIENT=æ¥æ”¶æ€»ç»“çš„é‚®ç®±

# SMTPé…ç½®
SMTP_USE_SSL=true
```

### 2. æµ‹è¯•è¿è¡Œ

```bash
# ç«‹å³æ‰§è¡Œä¸€æ¬¡æµ‹è¯•
python main.py --once
```

### 3. è®¾ç½®å®šæ—¶ä»»åŠ¡

**é€‰é¡¹ A: ä½¿ç”¨å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
./install_launchd.sh
```

**é€‰é¡¹ B: æ‰‹åŠ¨å®‰è£…**
```bash
# å¤åˆ¶ plist æ–‡ä»¶
cp com.user.dailysummary.plist ~/Library/LaunchAgents/

# åŠ è½½æœåŠ¡
launchctl load ~/Library/LaunchAgents/com.user.dailysummary.plist
```

## â° å®šæ—¶ä»»åŠ¡è¯´æ˜

- **æ‰§è¡Œæ—¶é—´**: æ¯å¤©æ™šä¸Š 22:00
- **æ‰§è¡Œå†…å®¹**: è¯»å–è¿‡å»24å°æ—¶çš„"æ¯æ—¥æ€»ç»“"é‚®ä»¶å¹¶åˆ†æ
- **è¿è¡Œæ–¹å¼**: `python main.py --once`ï¼ˆæ‰§è¡Œå®Œè‡ªåŠ¨é€€å‡ºï¼‰
- **ç³»ç»Ÿè¦æ±‚**: macOS ä¿æŒå¼€æœºï¼ˆå¯ä»¥åˆç›–ï¼Œä¸èƒ½å…³æœºï¼‰

## ğŸ“Š æŸ¥çœ‹æ—¥å¿—

### ç¨‹åºæ—¥å¿—
```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
tail -f logs/workflow_$(date +%Y%m%d).log

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶
ls -lh logs/
```

### launchd æ—¥å¿—
```bash
# æ ‡å‡†è¾“å‡º
tail -f logs/launchd_out.log

# é”™è¯¯è¾“å‡º
tail -f logs/launchd_err.log
```

## ğŸ› ï¸ ç®¡ç†å®šæ—¶ä»»åŠ¡

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
launchctl list | grep dailysummary
```

### æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡
```bash
launchctl start com.user.dailysummary
```

### åœæ­¢æœåŠ¡
```bash
launchctl unload ~/Library/LaunchAgents/com.user.dailysummary.plist
```

### é‡æ–°åŠ è½½æœåŠ¡ï¼ˆä¿®æ”¹é…ç½®åï¼‰
```bash
launchctl unload ~/Library/LaunchAgents/com.user.dailysummary.plist
launchctl load ~/Library/LaunchAgents/com.user.dailysummary.plist
```

### åˆ é™¤æœåŠ¡
```bash
launchctl unload ~/Library/LaunchAgents/com.user.dailysummary.plist
rm ~/Library/LaunchAgents/com.user.dailysummary.plist
```

## ğŸ“ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|----------|------|
| `main.py` | ä¸»ç¨‹åº |
| `.env` | ç¯å¢ƒå˜é‡é…ç½® |
| `config.py` | ç¨‹åºé…ç½® |
| `com.user.dailysummary.plist` | launchd é…ç½®æ–‡ä»¶ |
| `install_launchd.sh` | è‡ªåŠ¨å®‰è£…è„šæœ¬ |
| `logs/` | æ—¥å¿—ç›®å½• |
| `history/` | å†å²è®°å½•ç›®å½• |
| `LAUNCHD_SETUP.md` | è¯¦ç»†è®¾ç½®æŒ‡å— |

## ğŸ”§ ä¿®æ”¹æ‰§è¡Œæ—¶é—´

ç¼–è¾‘ `~/Library/LaunchAgents/com.user.dailysummary.plist`ï¼š

```xml
<key>StartCalendarInterval</key>
<dict>
    <key>Hour</key>
    <integer>22</integer>  <!-- å°æ—¶ (0-23) -->
    <key>Minute</key>
    <integer>0</integer>   <!-- åˆ†é’Ÿ (0-59) -->
</dict>
```

ç„¶åé‡æ–°åŠ è½½æœåŠ¡ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç”µè„‘éœ€è¦å¼€æœº**: launchd åªåœ¨ç”µè„‘å¼€æœºæ—¶è¿è¡Œï¼ˆå¯ä»¥åˆç›–ç¡çœ ï¼Œä½†ä¸èƒ½å…³æœºï¼‰

2. **Python è·¯å¾„**: ç¡®ä¿ plist ä¸­çš„ Python è·¯å¾„æ­£ç¡®
   ```bash
   which python  # æŸ¥çœ‹å½“å‰ Python è·¯å¾„
   ```

3. **ç¯å¢ƒå˜é‡**: `.env` æ–‡ä»¶å¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•

4. **é‚®ä»¶ç­›é€‰**:
   - ä¸»é¢˜å¿…é¡»åŒ…å« `EMAIL_FILTER_SUBJECT` çš„å€¼ï¼ˆé»˜è®¤"æ¯æ—¥æ€»ç»“"ï¼‰
   - å‘ä»¶äººå¿…é¡»æ˜¯ `EMAIL_FILTER_SENDER` çš„å€¼

5. **æ—¶åŒº**: æ‰§è¡Œæ—¶é—´åŸºäºç³»ç»Ÿæ—¶åŒº

## ğŸ§ª æµ‹è¯•æµç¨‹

1. **æµ‹è¯•ç«‹å³æ‰§è¡Œ**:
   ```bash
   python main.py --once
   ```

2. **æ£€æŸ¥æ—¥å¿—**:
   ```bash
   tail -20 logs/workflow_$(date +%Y%m%d).log
   ```

3. **æ£€æŸ¥é‚®ç®±**: ç¡®è®¤æ”¶åˆ°AIåˆ†æé‚®ä»¶

4. **æµ‹è¯• launchd**:
   ```bash
   # æ‰‹åŠ¨è§¦å‘
   launchctl start com.user.dailysummary

   # æŸ¥çœ‹æ—¥å¿—
   tail -20 logs/launchd_out.log
   ```

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜1: æœåŠ¡æœªæ‰§è¡Œ
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
launchctl list | grep dailysummary

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -50 logs/launchd_err.log

# æ‰‹åŠ¨æµ‹è¯•
python main.py --once
```

### é—®é¢˜2: æ‰¾ä¸åˆ°é‚®ä»¶
- æ£€æŸ¥ `.env` ä¸­çš„ `EMAIL_FILTER_SENDER` å’Œ `EMAIL_FILTER_SUBJECT`
- ç¡®è®¤é‚®ä»¶ç¡®å®å­˜åœ¨ä¸”æ—¶é—´åœ¨24å°æ—¶å†…
- æŸ¥çœ‹æ—¥å¿—äº†è§£è¯¦ç»†æƒ…å†µ

### é—®é¢˜3: AI åˆ†æå¤±è´¥
- æ£€æŸ¥ `GEMINI_API_KEY` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- æ£€æŸ¥ Gemini API é…é¢

## ğŸ“š æ›´å¤šæ–‡æ¡£

- è¯¦ç»†è®¾ç½®æŒ‡å—: `LAUNCHD_SETUP.md`
- QQé‚®ç®±é…ç½®: `QQé‚®ç®±é…ç½®æŒ‡å—.md`
- é¡¹ç›®è¯´æ˜: `README.md`
